<form id="dreamForm">
  <input type="text" name="name" placeholder="Ad Soyad" required />
  <input type="email" name="email" placeholder="E-posta" required />
  <textarea name="message" placeholder="Rüyanız" rows="6" required></textarea>

  <!-- honeypot -->
  <input type="text" name="_honey" autocomplete="off" tabindex="-1" style="display:none">

  <button id="sendBtn" type="submit">Gönder</button>
  <p id="formMsg" style="margin-top:10px"></p>
</form>

<script>
  const form = document.getElementById('dreamForm');
  const btn = document.getElementById('sendBtn');
  const msg = document.getElementById('formMsg');

  form.addEventListener('submit', async (e) => {
    e.preventDefault();
    msg.textContent = '';
    btn.disabled = true; btn.textContent = 'Gönderiliyor…';

    const fd = new FormData(form);
    const payload = {
      name: fd.get('name'),
      email: fd.get('email'),
      message: fd.get('message'),
      _honey: fd.get('_honey') || ''
    };

    try {
      const r = await fetch('/api/send-email', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(payload)
      });
      const j = await r.json();
      if (j.ok) {
        window.location.href = '/thanks.html';
      } else {
        msg.textContent = 'Bağlantı hatası. Lütfen tekrar deneyin.';
      }
    } catch (err) {
      msg.textContent = 'Bağlantı hatası. Lütfen tekrar deneyin.';
    } finally {
      btn.disabled = false; btn.textContent = 'Gönder';
    }
  });
</script>
