<!doctype html>
<html lang="tr">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>RÃ¼yanÄ± GÃ¶nder | DreamOracle</title>
  <meta name="description" content="Formu doldur, 24 saat iÃ§inde gelen kutuna yorum gelsin. Ä°stersen Premium yorum ve koÃ§luk da ekleyebilirsin.">
  <link rel="icon" href="/favicon.svg">
  <style>
    :root{
      --bg:#0c1424;--panel:#0f1a2e;--ink:#e8f1ff;--muted:#a3badc;--line:#1a2743;
      --brand:#46c8ff;--accent:#16a0db;--ok:#2aa16a;--err:#cc3d4b
    }
    *{box-sizing:border-box}
    body{margin:0;background:var(--bg);color:var(--ink);font:16px/1.6 Inter,system-ui,-apple-system,Segoe UI,Roboto}
    .wrap{max-width:980px;margin:0 auto;padding:24px}
    nav{display:flex;gap:14px;align-items:center;justify-content:space-between;padding:10px 0}
    a{color:#8dd8ff;text-decoration:none}
    .brand{font-weight:800}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:20px}
    label{display:block;margin:10px 0 6px;color:#cfe2ff}
    input,select,textarea{
      width:100%;padding:12px 12px;border-radius:12px;border:1px solid #274567;
      background:#0c1a30;color:#e8f1ff;outline:none
    }
    textarea{min-height:160px;resize:vertical}
    .btn{
      background:#123155;border:1px solid #224670;color:#dff6ff;padding:12px 16px;border-radius:12px;
      display:inline-flex;gap:8px;cursor:pointer
    }
    .btn-primary{background:linear-gradient(180deg,#45c8ff,#16a0db);border-color:#2998c8;color:#06233b}
    .grid{display:grid;gap:18px;grid-template-columns:1.1fr .9fr}
    @media (max-width:900px){.grid{grid-template-columns:1fr}}
    .badge{display:inline-flex;gap:8px;background:#0f243e;border:1px solid #223a5f;color:#9fd3ff;padding:6px 10px;border-radius:999px;font-size:12px}
    .muted{color:var(--muted)}
    .note-ok,.note-err{margin-top:12px;padding:12px;border-radius:10px}
    .note-ok{background:#0f2a22;border:1px solid #1f6f4d;color:#b7ffdc}
    .note-err{background:#2a0f14;border:1px solid #7a2a36;color:#ffc3cd}
    .aside{display:grid;gap:12px}
    .kicker{letter-spacing:.2em;text-transform:uppercase;color:#8fb1d6;font-size:12px}
    .pill{display:inline-flex;padding:4px 10px;border:1px solid #224670;border-radius:999px;background:#0f2542;color:#bfe6ff;font-size:12px}
  </style>
</head>
<body>
<header class="wrap">
  <nav>
    <div class="brand">DreamOracle</div>
    <div style="display:flex;gap:12px">
      <a href="/index.html">Anasayfa</a>
      <a href="/premium.html">Premium</a>
      <a class="pill" href="/coach.html">KoÃ§luk</a>
    </div>
  </nav>
</header>

<main class="wrap">
  <div class="grid">
    <section class="panel">
      <div style="display:flex;gap:10px;align-items:center;flex-wrap:wrap">
        <span class="badge" id="kategoriBadge" hidden></span>
        <span class="badge" id="paketBadge" hidden></span>
      </div>

      <h1 style="margin:8px 0 2px">RÃ¼yanÄ± GÃ¶nder</h1>
      <p class="muted" style="margin:0 0 12px">Formu doldur, 24 saat iÃ§inde e-postana yanÄ±t gelsin. URLâ€™den geldiysen kategori/paket alanlarÄ±nÄ± senin iÃ§in seÃ§tik.</p>

      <form id="dreamForm" novalidate>
        <!-- gizli alanlar (serverâ€™a dÃ¼z metin olarak gitsin) -->
        <input type="hidden" name="kategori" id="kategoriHidden">
        <input type="hidden" name="paket" id="paketHidden">

        <label for="name">Ad Soyad</label>
        <input id="name" name="name" placeholder="Ad Soyad" autocomplete="name" required>

        <label for="email">E-posta</label>
        <input id="email" name="email" type="email" placeholder="ornek@mail.com" autocomplete="email" required>

        <div style="display:grid;grid-template-columns:1fr 1fr;gap:12px;margin-top:10px">
          <div>
            <label for="paket">Paket</label>
            <select id="paket" name="paket_select">
              <option value="standart">Standart (Ãœcretsiz)</option>
              <option value="master">Premium Yorum + KoÃ§luk</option>
              <option value="pro">KoÃ§luk (7 gÃ¼n mikro takip)</option>
            </select>
          </div>
          <div>
            <label for="oncelik">Ã–ncelik</label>
            <select id="oncelik" name="priority">
              <option value="genel">Genel yorum</option>
              <option value="kariyer">Kariyer/para odaÄŸÄ±</option>
              <option value="iliski">Ä°liÅŸki/iletiÅŸim odaÄŸÄ±</option>
              <option value="saglik">Rutin/saÄŸlÄ±k odaÄŸÄ±</option>
            </select>
          </div>
        </div>

        <label for="message" style="margin-top:8px">RÃ¼yanÄ±z</label>
        <textarea id="message" name="message" placeholder="RÃ¼yanÄ± mÃ¼mkÃ¼n olduÄŸunca detaylÄ± yaz. Yer, kiÅŸiler, hissettiklerin, tekrar eden sembollerâ€¦" required></textarea>

        <!-- basit honeypot -->
        <input type="text" name="website" id="hp" tabindex="-1" autocomplete="off" style="position:absolute;left:-9999px;opacity:0">

        <button class="btn btn-primary" type="submit" id="submitBtn">GÃ¶nder â†’</button>
        <div id="note" class="note-ok" style="display:none"></div>
        <div id="noteErr" class="note-err" style="display:none"></div>
      </form>
    </section>

    <aside class="aside">
      <div class="panel">
        <div class="kicker">Neler olur?</div>
        <ul style="margin:8px 0 0 18px">
          <li>RÃ¼yadaki temalarÄ± hedeflerle eÅŸleÅŸtiririz.</li>
          <li>3â€“5 maddelik kÃ¼Ã§Ã¼k aksiyon listesi Ã§Ä±kar.</li>
          <li>Standartta 24 saat iÃ§inde e-posta alÄ±rsÄ±n.</li>
        </ul>
      </div>
      <div class="panel">
        <b>Ä°puÃ§larÄ±</b>
        <p class="muted">Tekrarlayan semboller, gÃ¼Ã§lÃ¼ duygular ve â€œuyandÄ±ktan sonra aklÄ±mda kalanâ€ sahneler Ã§ok yardÄ±mcÄ± olur.</p>
      </div>
    </aside>
  </div>
</main>

<script>
(function(){
  const qs = new URLSearchParams(location.search);
  const kategori = (qs.get('kategori') || '').toLowerCase();     // ruya, tarot, kahve, astro, kocluk
  const paketQS  = (qs.get('paket')    || '').toLowerCase();     // standart, master, pro

  const kategoriHidden = document.getElementById('kategoriHidden');
  const paketHidden    = document.getElementById('paketHidden');
  const paketSelect    = document.getElementById('paket');
  const kategoriBadge  = document.getElementById('kategoriBadge');
  const paketBadge     = document.getElementById('paketBadge');

  // Kategori etiketi (rozet)
  const kategoriMap = {
    ruya:'RÃ¼ya', tarot:'Tarot', kahve:'Kahve', astro:'YÄ±ldÄ±z', kocluk:'KoÃ§luk'
  };
  if (kategori && kategoriMap[kategori]) {
    kategoriBadge.textContent = 'Kategori: ' + kategoriMap[kategori];
    kategoriBadge.hidden = false;
    kategoriHidden.value = kategoriMap[kategori];
  }

  // Paket seÃ§im ve rozet
  const validPacks = ['standart','master','pro'];
  if (validPacks.includes(paketQS)) {
    paketSelect.value = paketQS;
    paketBadge.textContent = 'Paket: ' + (
      paketQS === 'standart' ? 'Standart' :
      paketQS === 'master'   ? 'Premium Yorum + KoÃ§luk' : 'KoÃ§luk'
    );
    paketBadge.hidden = false;
    paketHidden.value = paketQS;
  } else {
    // URL yoksa, kullanÄ±cÄ± seÃ§im yapsÄ±n; gÃ¶nderirken yine koyacaÄŸÄ±z
    paketHidden.value = paketSelect.value;
  }

  // SeÃ§im deÄŸiÅŸirse hidden alanÄ± gÃ¼ncelle
  paketSelect.addEventListener('change', () => {
    paketHidden.value = paketSelect.value;
    if(!paketBadge.hidden){
      paketBadge.textContent = 'Paket: ' + (
        paketSelect.value === 'standart' ? 'Standart' :
        paketSelect.value === 'master'   ? 'Premium Yorum + KoÃ§luk' : 'KoÃ§luk'
      );
    }
  });

  // Form gÃ¶nderimi
  const form = document.getElementById('dreamForm');
  const noteOk = document.getElementById('note');
  const noteErr= document.getElementById('noteErr');
  const btn    = document.getElementById('submitBtn');

  function show(el, msg){ el.textContent = msg; el.style.display='block'; }
  function hideAll(){ noteOk.style.display='none'; noteErr.style.display='none'; }

  form.addEventListener('submit', async (e)=>{
    e.preventDefault();
    hideAll();

    // Basit validasyon
    const name = form.name.value.trim();
    const email= form.email.value.trim();
    const msg  = form.message.value.trim();
    if (!name || !email || !msg){
      show(noteErr, 'LÃ¼tfen ad, e-posta ve rÃ¼ya alanlarÄ±nÄ± doldur.');
      return;
    }
    // honeypot
    if (form.website.value) { show(noteErr,'Ä°stek reddedildi.'); return; }

    btn.disabled = true; btn.textContent = 'GÃ¶nderiliyorâ€¦';

    // Sunucuya paketi/kategoriyi aÃ§Ä±kÃ§a ilet
    const payload = {
      name, email,
      paket:pakket(form),
      kategori: kategoriHidden.value || kategoriMap[kategori] || '',
      priority: form.priority.value,
      message: msg
    };

    try{
      const res = await fetch('/api/send-email', {
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify(payload)
      });
      if(!res.ok) throw new Error('Sunucu: '+res.status);
      show(noteOk,'RÃ¼yan ulaÅŸtÄ±. E-postanÄ± kontrol edebilirsin. ğŸ‘');
      form.reset();
      // seÃ§ili rozetleri sÄ±fÄ±rlama (paketi varsayÄ±lan yap)
      paketSelect.value = 'standart';
      paketHidden.value = 'standart';
    }catch(err){
      console.error(err);
      show(noteErr,'Bir ÅŸeyler ters gitti. Birazdan tekrar dener misin?');
    }finally{
      btn.disabled = false; btn.textContent = 'GÃ¶nder â†’';
    }
  });

  function pakket(f){
    // hidden varsa onu kullan, yoksa select
    return (paketHidden.value || f.paket_select.value || 'standart').toLowerCase();
  }
})();
</script>
</body>
</html>
